<html>
<head><title>Vinkenstein pricing engine</title></head>
<body>
<h1>Vinkenstein pricing engine</h1>
<form>Enter a VIN of the vehicle you are trying to price: <input type="text" name="vin" id="vin_field"><button type="button" onclick="callServer()">Price it!</button></form>
<script>
function callServer() {
  var vin = document.getElementById("vin_field").value
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var assessment = JSON.parse(this.responseText);
      var listings = assessment.comparables
      for (i in listings) {
        var listingDiv = listingLine(listings[i].listing);
        addDataSpan(listingDiv, listings[i].similarityScore);
        document.getElementById("comparables").appendChild(listingDiv);
      };
      document.getElementById("assessed-vehicle").appendChild(listingLine(assessment.assessedVehicle));
      document.getElementById("suggested-price").innerHTML = assessment.suggestedPrice;
    };
  };
  xhttp.open("GET", "/assessment?vin="+vin, true);
  xhttp.send();
}

function listingLine(listing) {
  var listingMainElement = document.createElement("DIV");
  addDataSpan(listingMainElement, listing.vin);
  addDataSpan(listingMainElement, listing.price);
  addDataSpan(listingMainElement, listing.make);
  addDataSpan(listingMainElement, listing.model);
  addDataSpan(listingMainElement, listing.year);
  addDataSpan(listingMainElement, listing.numberOfOwners);
  addDataSpan(listingMainElement, listing.numberOfAccidents);

  return listingMainElement;
}

function addDataSpan(parentDiv, contents) {
  var dataSpan = document.createElement("SPAN");
  dataSpan.innerHTML = contents+" &nbsp;";
  parentDiv.appendChild(dataSpan);
}

</script>
Suggested price: <div id="suggested-price"></div>
<br>
Information about assessed vehicle: <div id="assessed-vehicle"></div>
<br>
Comparables: <div id="comparables"></div>
<br>
<br>
<p>Example vins: WBSBG9321VEY74382, 1FM5K8F82EGA64580</p>

</body>
</html>